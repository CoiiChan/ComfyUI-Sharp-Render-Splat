# Splat Orbit Render

> **é¡¹ç›®ä¿®æ”¹è¯´æ˜**ï¼šæœ¬é¡¹ç›®åŸºäº [PlayCanvas/splat-transform](https://github.com/playcanvas/splat-transform) å¼€æºé¡¹ç›®è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•ã€‚åŸå§‹é¡¹ç›®ç”¨äºå°† PLY Gaussian Splat æ–‡ä»¶è½¬æ¢ä¸º HTML viewerï¼Œæœ¬å·¥å…·åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ äº†ç¯ç»•æ¸²æŸ“åŠŸèƒ½ï¼Œå¹¶ä¿®æ”¹äº†é»˜è®¤ç›¸æœºè½¨è¿¹è®¾ç½®ã€‚

## ä¸»è¦ä¿®æ”¹å†…å®¹

### 1. æ–°å¢ Orbit Render åŠŸèƒ½
- æ·»åŠ äº† `tools/orbit-render/` ç›®å½•ï¼ŒåŒ…å«å®Œæ•´çš„ç¯ç»•æ¸²æŸ“å·¥å…·
- æ”¯æŒå‘½ä»¤è¡Œå‚æ•°æ§åˆ¶ç›¸æœºè½¨é“ã€é«˜åº¦ã€FOVã€åˆ†è¾¨ç‡ç­‰
- ä½¿ç”¨ Puppeteer æ— å¤´æµè§ˆå™¨å®ç°é«˜è´¨é‡ WebGL æ¸²æŸ“
- è‡ªåŠ¨ç”Ÿæˆç¯ç»•åºåˆ—å›¾åƒï¼Œæ”¯æŒè‡ªå®šä¹‰å¸§æ•°å’Œè¾“å‡ºæ ¼å¼

### 2. ä¿®æ”¹ HTML Viewer é»˜è®¤ç›¸æœºè½¨è¿¹
- ä¿®æ”¹äº† `src/writers/write-html.ts` æ–‡ä»¶
- ç”Ÿæˆçš„ HTML viewer é»˜è®¤ä½¿ç”¨ç¯ç»•ç›¸æœºè½¨è¿¹ï¼ˆ`startAnim: 'animTrack'`ï¼‰
- é»˜è®¤ç¯ç»•å‚æ•°ï¼š
  - ç¯ç»•ä¸­å¿ƒï¼š(0, 0, 2)
  - ç¯ç»•åŠå¾„ï¼š2
  - æ—‹è½¬è§’åº¦èŒƒå›´ï¼š173Â° åˆ° 187Â°ï¼ˆrotation yï¼‰
  - FOVï¼š50
  - åŠ¨ç”»æ—¶é•¿ï¼š10ç§’
  - å…³é”®å¸§ï¼š5ä¸ªï¼ˆ0, 0.25, 0.5, 0.75, 1ï¼‰
  - æ’å€¼æ–¹å¼ï¼šçº¿æ€§
  - å¾ªç¯æ¨¡å¼ï¼šå¾ªç¯
- ç›¸æœºä»æ­£é¢çœ‹å‘ç›®æ ‡ç‚¹ï¼Œé¿å…çœ‹åˆ°ç‚¹äº‘çš„èƒŒéƒ¨

### 3. ä¿®æ”¹çš„æ–‡ä»¶
- `src/writers/write-html.ts`ï¼šä¿®æ”¹é»˜è®¤ç›¸æœºè½¨è¿¹è®¾ç½®
- `tools/orbit-render/index.mjs`ï¼šæ–°å¢ç¯ç»•æ¸²æŸ“å·¥å…·ä¸»ç¨‹åº
- `tools/orbit-render/package.json`ï¼šæ–°å¢å·¥å…·ä¾èµ–é…ç½®
- `tools/orbit-render/README.md`ï¼šæœ¬æ–‡æ¡£

---

å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå°† PLY Gaussian Splat æ–‡ä»¶æ¸²æŸ“ä¸ºç¯ç»•åºåˆ—å›¾åƒã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ è‡ªåŠ¨ç”Ÿæˆç¯ç»•ç›¸æœºçš„åºåˆ—å›¾åƒ
- ğŸ“ å¯è‡ªå®šä¹‰ç›¸æœºè½¨é“åŠå¾„ã€é«˜åº¦ã€FOV
- ğŸ–¼ï¸ æ”¯æŒè‡ªå®šä¹‰è¾“å‡ºåˆ†è¾¨ç‡
- ğŸ¯ å¯è®¾ç½®ç›¸æœºç›®æ ‡ç‚¹å’Œèµ·å§‹è§’åº¦
- ğŸ§¹ è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- ğŸš€ åŸºäº Puppeteer æ— å¤´æµè§ˆå™¨ï¼Œé«˜è´¨é‡ WebGL æ¸²æŸ“

## å®‰è£…ä¾èµ–

```bash
cd tools/orbit-render
npm install
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æ¸²æŸ“ 36 å¸§ï¼ˆ360åº¦ç¯ç»•ï¼Œæ¯10åº¦ä¸€å¸§ï¼‰
node index.mjs input.ply

# æŒ‡å®šè¾“å‡ºç›®å½•
node index.mjs input.ply -o ./my_frames
```

### é«˜çº§ç”¨æ³•

```bash
# æ¸²æŸ“ 72 å¸§ï¼Œç›¸æœºè·ç¦» 10 å•ä½
node index.mjs input.ply -f 72 -r 10

# è‡ªå®šä¹‰å›¾åƒå°ºå¯¸ï¼ˆ4K åˆ†è¾¨ç‡ï¼‰
node index.mjs input.ply -w 3840 -H 2160

# è®¾ç½®ç›¸æœºé«˜åº¦å’Œç›®æ ‡ç‚¹
node index.mjs input.ply -h 3 --target 0,1,0

# ä»ç‰¹å®šè§’åº¦å¼€å§‹æ¸²æŸ“
node index.mjs input.ply --start-angle 45

# æ¸²æŸ“å®Œæˆåè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
node index.mjs input.ply --cleanup

# é™é»˜æ¨¡å¼ï¼ˆåªè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼‰
node index.mjs input.ply -q
```

### å®Œæ•´ç¤ºä¾‹

```bash
node index.mjs bunny.ply \
  -o ./bunny_orbit \
  -f 72 \
  -r 8 \
  -h 2.5 \
  -w 1920 \
  -H 1080 \
  --fov 45 \
  --target 0,0,0 \
  --start-angle 0 \
  --cleanup
```

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--output` | `-o` | `./frames` | è¾“å‡ºç›®å½•è·¯å¾„ |
| `--frames` | `-f` | `36` | æ¸²æŸ“å¸§æ•° |
| `--radius` | `-r` | `2` | ç›¸æœºè½¨é“åŠå¾„ï¼ˆç¯ç»•ä¸­å¿ƒåœ¨ 0,0,rï¼‰ |
| `--height` | `-h` | `2` | ç›¸æœºé«˜åº¦ |
| `--width` | `-w` | `1920` | å›¾åƒå®½åº¦ï¼ˆåƒç´ ï¼‰ |
| `--img-height` | `-H` | `1080` | å›¾åƒé«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| `--fov` | - | `50` | ç›¸æœºè§†åœºè§’ï¼ˆåº¦ï¼‰ |
| `--target` | `-t` | `0,0,0` | ç›¸æœºç›®æ ‡ç‚¹ï¼ˆx,y,zï¼‰ |
| `--start-angle` | - | `0` | èµ·å§‹è§’åº¦ï¼ˆåº¦ï¼‰ |
| `--cleanup` | - | `false` | æ¸²æŸ“åæ¸…ç†ä¸´æ—¶æ–‡ä»¶ |
| `--quiet` | `-q` | `false` | é™é»˜æ¨¡å¼ |
| `--help` | - | - | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

## è¾“å‡ºæ ¼å¼

æ¸²æŸ“å®Œæˆåï¼Œåœ¨è¾“å‡ºç›®å½•ä¸­ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
frames/
â”œâ”€â”€ frame_000.png
â”œâ”€â”€ frame_001.png
â”œâ”€â”€ frame_002.png
â”œâ”€â”€ ...
â””â”€â”€ frame_035.png
```

æ–‡ä»¶åæ ¼å¼ä¸º `frame_XXX.png`ï¼Œå…¶ä¸­ XXX æ˜¯ä¸‰ä½æ•°çš„å¸§ç¼–å·ï¼ˆä» 000 å¼€å§‹ï¼‰ã€‚

## å·¥ä½œåŸç†

1. **ç”Ÿæˆ HTML Viewer**: ä½¿ç”¨ `splat-transform` å°† PLY æ–‡ä»¶è½¬æ¢ä¸º HTML viewer
2. **å¯åŠ¨æ— å¤´æµè§ˆå™¨**: ä½¿ç”¨ Puppeteer å¯åŠ¨ Chrome/Chromium æ— å¤´æ¨¡å¼
3. **åŠ è½½åœºæ™¯**: åœ¨æµè§ˆå™¨ä¸­åŠ è½½ HTML viewer å¹¶ç­‰å¾…åœºæ™¯åŠ è½½å®Œæˆ
4. **ç¯ç»•æ¸²æŸ“**: æŒ‰æŒ‡å®šè§’åº¦é—´éš”ç§»åŠ¨ç›¸æœºå¹¶æˆªå›¾
5. **ä¿å­˜å›¾åƒ**: å°†æ¯å¸§ä¿å­˜ä¸º PNG æ–‡ä»¶

## æŠ€æœ¯è¦æ±‚

- Node.js >= 18.0.0
- å·²å®‰è£… `splat-transform` CLI å·¥å…·
- ç³»ç»Ÿæ”¯æŒ WebGLï¼ˆç”¨äºæµè§ˆå™¨æ¸²æŸ“ï¼‰

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¸§æ•°é€‰æ‹©**: 
   - 36 å¸§ï¼ˆæ¯10åº¦ï¼‰é€‚åˆå¿«é€Ÿé¢„è§ˆ
   - 72 å¸§ï¼ˆæ¯5åº¦ï¼‰é€‚åˆæ ‡å‡†è§†é¢‘
   - 120 å¸§ï¼ˆæ¯3åº¦ï¼‰é€‚åˆé«˜è´¨é‡åŠ¨ç”»

2. **åˆ†è¾¨ç‡é€‰æ‹©**:
   - 1920x1080: æ ‡å‡†é«˜æ¸…
   - 2560x1440: 2K åˆ†è¾¨ç‡
   - 3840x2160: 4K åˆ†è¾¨ç‡ï¼ˆæ¸²æŸ“æ—¶é—´è¾ƒé•¿ï¼‰

3. **ç›¸æœºè®¾ç½®**:
   - åŠå¾„æ ¹æ®åœºæ™¯å¤§å°è°ƒæ•´
   - é«˜åº¦é€šå¸¸è®¾ç½®ä¸ºåœºæ™¯é«˜åº¦çš„ 1.5-2 å€
   - FOV 45-60 åº¦é€‚åˆå¤§å¤šæ•°åœºæ™¯

## æ•…éšœæ’é™¤

### é—®é¢˜: "splat-transform not found"

ç¡®ä¿å·²å…¨å±€å®‰è£… splat-transform:
```bash
npm install -g @playcanvas/splat-transform
```

### é—®é¢˜: "Failed to generate HTML viewer"

æ£€æŸ¥ PLY æ–‡ä»¶æ˜¯å¦æœ‰æ•ˆï¼Œç¡®ä¿ splat-transform å¯ä»¥æ­£å¸¸è¯»å–è¯¥æ–‡ä»¶ã€‚

### é—®é¢˜: æµè§ˆå™¨å¯åŠ¨å¤±è´¥

ç¡®ä¿ç³»ç»Ÿå·²å®‰è£… Chrome æˆ– Chromiumï¼Œæˆ–è€… Puppeteer ä¼šè‡ªåŠ¨ä¸‹è½½ã€‚

### é—®é¢˜: æ¸²æŸ“é€Ÿåº¦æ…¢

- å‡å°‘å¸§æ•°
- é™ä½åˆ†è¾¨ç‡
- ä½¿ç”¨ `--cleanup` é€‰é¡¹å‡å°‘ç£ç›˜ I/O

## ç¤ºä¾‹åœºæ™¯

### 1. å¿«é€Ÿé¢„è§ˆï¼ˆä½è´¨é‡ï¼‰

```bash
node index.mjs model.ply -f 18 -w 1280 -H 720 -r 3
```

### 2. æ ‡å‡†è§†é¢‘ï¼ˆä¸­ç­‰è´¨é‡ï¼‰

```bash
node index.mjs model.ply -f 72 -w 1920 -H 1080 -r 5
```

### 3. é«˜è´¨é‡åŠ¨ç”»ï¼ˆ4Kï¼‰

```bash
node index.mjs model.ply -f 120 -w 3840 -H 2160 -r 8 --cleanup
```

### 4. é¡¶éƒ¨ä¿¯è§†ç¯ç»•

```bash
node index.mjs model.ply -h 10 -r 5 -f 36
```

### 5. å±€éƒ¨ç‰¹å†™ç¯ç»•

```bash
node index.mjs model.ply -r 2 -h 1 -f 72 --target 0,0.5,0
```

## åå¤„ç†å»ºè®®

ç”Ÿæˆçš„åºåˆ—å›¾åƒå¯ä»¥ç”¨äºï¼š

1. **è§†é¢‘åˆ¶ä½œ**: ä½¿ç”¨ FFmpeg åˆæˆè§†é¢‘
   ```bash
   ffmpeg -framerate 30 -i frames/frame_%03d.png -c:v libx264 -pix_fmt yuv420p output.mp4
   ```

2. **GIF åŠ¨ç”»**: ä½¿ç”¨ ImageMagick æˆ–å…¶ä»–å·¥å…·
   ```bash
   convert -delay 10 -loop 0 frames/frame_*.png animation.gif
   ```

3. **3D é¢„è§ˆå›¾**: é€‰æ‹©å…³é”®å¸§ç”¨äºæ–‡æ¡£æˆ–å±•ç¤º

## è®¸å¯è¯

MIT

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
