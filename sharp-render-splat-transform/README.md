# SplatTransform - 3D Gaussian Splat Converter

[![NPM Version](https://img.shields.io/npm/v/@playcanvas/splat-transform.svg)](https://www.npmjs.com/package/@playcanvas/splat-transform)
[![NPM Downloads](https://img.shields.io/npm/dw/@playcanvas/splat-transform)](https://npmtrends.com/@playcanvas/splat-transform)
[![License](https://img.shields.io/npm/l/@playcanvas/splat-transform.svg)](https://github.com/playcanvas/splat-transform/blob/main/LICENSE)
[![Discord](https://img.shields.io/badge/Discord-5865F2?style=flat&logo=discord&logoColor=white&color=black)](https://discord.gg/RSaMRzg)
[![Reddit](https://img.shields.io/badge/Reddit-FF4500?style=flat&logo=reddit&logoColor=white&color=black)](https://www.reddit.com/r/PlayCanvas)
[![X](https://img.shields.io/badge/X-000000?style=flat&logo=x&logoColor=white&color=black)](https://x.com/intent/follow?screen_name=playcanvas)

| [User Guide](https://developer.playcanvas.com/user-manual/gaussian-splatting/editing/splat-transform/) | [Blog](https://blog.playcanvas.com/) | [Forum](https://forum.playcanvas.com/) |

> **ğŸ†• Modified Version**: This is a modified version of the original [PlayCanvas SplatTransform](https://github.com/playcanvas/splat-transform) with added **Orbit Render** functionality for rendering PLY files into orbit image sequences.

> **ğŸ“ Coordinate System Adaptation**: This version includes coordinate system adaptations specifically optimized for PLY files generated by Apple's open-source [ml-sharp](https://github.com/apple/ml-sharp) model. The orbit rendering logic has been adjusted to work with the coordinate space conventions used by ml-sharp, ensuring proper camera positioning and rotation for optimal viewing of point clouds generated by this model.

## ğŸ¬ New Feature: Orbit Render

A powerful command-line tool for rendering PLY Gaussian Splat files into orbit image sequences. Perfect for creating 3D model previews, animations, and video content.

### Quick Start

```bash
cd tools/orbit-render
npm install

# Render 36 frames with default settings
node index.mjs input.ply

# Render with custom settings
node index.mjs input.ply -f 72 -r 10 -o ./my_frames --fov 45
```

### Key Features

- ğŸ¬ **Automatic Orbit Animation**: Generate smooth camera orbit sequences
- ğŸ“ **Customizable Parameters**: Adjust orbit radius, height, FOV, and more
- ğŸ–¼ï¸ **Flexible Output**: Support for custom resolutions (HD, 2K, 4K)
- ğŸ¯ **Precise Control**: Set camera target points and start angles
- ğŸ§¹ **Auto Cleanup**: Option to automatically remove temporary files
- ğŸš€ **High Quality**: WebGL rendering via Puppeteer headless browser

### Command Line Parameters

| Parameter | Short | Default | Description |
|-----------|-------|---------|-------------|
| `--output` | `-o` | `./frames` | Output directory for frames |
| `--frames` | `-f` | `36` | Number of frames to render |
| `--radius` | `-r` | `2` | Camera orbit radius (orbit center at 0,0,r) |
| `--height` | `-h` | `2` | Camera height |
| `--width` | `-w` | `1920` | Image width in pixels |
| `--img-height` | `-H` | `1080` | Image height in pixels |
| `--fov` | - | `50` | Camera field of view in degrees |
| `--target` | `-t` | `0,0,0` | Camera target point (x,y,z) |
| `--start-angle` | - | `0` | Start angle in degrees |
| `--cleanup` | - | `false` | Clean up temporary files after rendering |
| `--quiet` | `-q` | `false` | Suppress non-error output |
| `--help` | - | - | Show help and exit |

### Usage Examples

```bash
# Basic orbit render (36 frames, default settings)
node index.mjs input.ply

# High-quality 4K render with 72 frames
node index.mjs input.ply -f 72 -w 3840 -H 2160 --fov 45

# Render with custom orbit radius and target point
node index.mjs input.ply -r 5 -t 0,1,0

# Full example with all options
node index.mjs model.ply \
  -o ./output \
  -f 72 \
  -r 5 \
  -h 2 \
  -w 1920 \
  -H 1080 \
  --fov 45 \
  --target 0,0,0 \
  --cleanup
```

### Orbit Behavior

- **Orbit Center**: By default, the orbit center is at (0, 0, r) where r is the radius parameter
- **Middle Frame**: Camera position is near (0, 0, 0) for optimal viewing
- **Rotation**: Fixed rotation (180Â°, 0Â°, 180Â°) with Y-axis varying from -15Â° to 15Â°
- **Camera Height**: Always 0 for level viewing angle

### Output Format

Frames are saved as PNG files in the output directory:
```
frames/
â”œâ”€â”€ frame_000.png
â”œâ”€â”€ frame_001.png
â”œâ”€â”€ frame_002.png
â””â”€â”€ ...
```

### Post-Processing

Convert frames to video using FFmpeg:
```bash
ffmpeg -framerate 30 -i frames/frame_%03d.png -c:v libx264 -pix_fmt yuv420p output.mp4
```

### Testing and Verification

After cloning or downloading this repository, follow these steps to verify the installation and test the orbit-render functionality:

```bash
# 1. Install project dependencies
npm install

# 2. Install orbit-render tool dependencies
cd tools/orbit-render
npm install

# 3. Test orbit-render with your PLY file
node index.mjs input.ply test_orbit --frames 36 --radius 2 --fov 45

# 4. Test HTML viewer generation
node ../../dist/index.mjs input.ply test_viewer.html

# 5. Verify outputs
# Check generated frames
dir test_orbit\*.png

# Check generated HTML viewer
dir test_viewer.html

# Open HTML viewer in browser (Windows)
start test_viewer.html

# Open HTML viewer in browser (macOS/Linux)
open test_viewer.html  # macOS
xdg-open test_viewer.html  # Linux
```

**Expected Output:**
- `test_orbit/` directory containing 36 PNG frames (frame_000.png to frame_035.png)
- `test_viewer.html` file - standalone HTML viewer with default orbit animation

For detailed documentation, see [tools/orbit-render/README.md](tools/orbit-render/README.md).

---

SplatTransform is an open source CLI tool for converting and editing Gaussian splats. It can:

ğŸ“¥ Read PLY, Compressed PLY, SOG, SPLAT, KSPLAT, SPZ and LCC formats  
ğŸ“¤ Write PLY, Compressed PLY, SOG, CSV, HTML Viewer and LOD (streaming) formats  
ğŸ”— Merge multiple splats  
ğŸ”„ Apply transformations to input splats  
ğŸ›ï¸ Filter out Gaussians or spherical harmonic bands  
âš™ï¸ Procedurally generate splats using JavaScript generators  
ğŸ¬ **NEW: Render orbit sequences from PLY files** (see [tools/orbit-render](tools/orbit-render/))

## Installation

Install or update to the latest version:

```bash
npm install -g @playcanvas/splat-transform
```

## Usage

```bash
splat-transform [GLOBAL] input [ACTIONS]  ...  output [ACTIONS]
```

**Key points:**
- Input files become the working set; ACTIONS are applied in order
- The last file is the output; actions after it modify the final result

## Supported Formats

| Format | Input | Output | Description |
| ------ | ----- | ------ | ----------- |
| `.ply` | âœ… | âœ… | Standard PLY format |
| `.sog` | âœ… | âœ… | Bundled super-compressed format (recommended) |
| `meta.json` | âœ… | âœ… | Unbundled super-compressed format (accompanied by `.webp` textures) |
| `.compressed.ply` | âœ… | âœ… | Compressed PLY format (auto-detected and decompressed on read) |
| `.lcc` | âœ… | âŒ | LCC file format (XGRIDS) |
| `.ksplat` | âœ… | âŒ | Compressed splat format (mkkellogg format) |
| `.splat` | âœ… | âŒ | Compressed splat format (antimatter15 format) |
| `.spz` | âœ… | âŒ | Compressed splat format (Niantic format) |
| `.mjs` | âœ… | âŒ | Generate a scene using an mjs script (Beta) |
| `.csv` | âŒ | âœ… | Comma-separated values spreadsheet |
| `.html` | âŒ | âœ… | HTML viewer app (single-page or unbundled) based on SOG |

## Actions

Actions can be repeated and applied in any order:

```none
-t, --translate        <x,y,z>          Translate splats by (x, y, z)
-r, --rotate           <x,y,z>          Rotate splats by Euler angles (x, y, z) in degrees
-s, --scale            <factor>         Uniformly scale splats by factor
-H, --filter-harmonics <0|1|2|3>        Remove spherical harmonic bands > n
-N, --filter-nan                        Remove Gaussians with NaN or Inf values
-B, --filter-box       <x,y,z,X,Y,Z>    Remove Gaussians outside box (min, max corners)
-S, --filter-sphere    <x,y,z,radius>   Remove Gaussians outside sphere (center, radius)
-V, --filter-value     <name,cmp,value> Keep splats where <name> <cmp> <value>
                                          cmp âˆˆ {lt,lte,gt,gte,eq,neq}
-p, --params           <key=val,...>    Pass parameters to .mjs generator script
-l, --lod              <n>              Specify the level of detail of this model, n >= 0.
```

## Global Options

```none
-h, --help                              Show this help and exit
-v, --version                           Show version and exit
-q, --quiet                             Suppress non-error output
-w, --overwrite                         Overwrite output file if it exists
-i, --iterations       <n>              Iterations for SOG SH compression (more=better). Default: 10
-L, --list-gpus                         List all available GPU adapters and exit
-g, --gpu              <n|cpu>          Select device for SOG compression: GPU adapter index | 'cpu'
-E, --viewer-settings  <settings.json>  HTML viewer settings JSON file
-U, --unbundled                         Generate unbundled HTML viewer with separate files
-O, --lod-select       <n,n,...>        Comma-separated LOD levels to read from LCC input
-C, --lod-chunk-count  <n>              Approx number of Gaussians per LOD chunk in K. Default: 512
-X, --lod-chunk-extent <n>              Approx size of an LOD chunk in world units (m). Default: 16
```

> [!NOTE]
> See the [SuperSplat Viewer Settings Schema](https://github.com/playcanvas/supersplat-viewer?tab=readme-ov-file#settings-schema) for details on how to pass data to the `-E` option.

## Examples

### Basic Operations

```bash
# Simple format conversion
splat-transform input.ply output.csv

# Convert from .splat format
splat-transform input.splat output.ply

# Convert from .ksplat format
splat-transform input.ksplat output.ply

# Convert to compressed PLY
splat-transform input.ply output.compressed.ply

# Uncompress a compressed PLY back to standard PLY
# (compressed .ply is detected automatically on read)
splat-transform input.compressed.ply output.ply

# Convert to SOG bundled format
splat-transform input.ply output.sog

# Convert to SOG unbundled format
splat-transform input.ply output/meta.json

# Convert from SOG (bundled) back to PLY
splat-transform scene.sog restored.ply

# Convert from SOG (unbundled folder) back to PLY
splat-transform output/meta.json restored.ply

# Convert to standalone HTML viewer (bundled, single file)
splat-transform input.ply output.html

# Convert to unbundled HTML viewer (separate CSS, JS, and SOG files)
splat-transform -U input.ply output.html

# Convert to HTML viewer with custom settings
splat-transform -E settings.json input.ply output.html
```

### Transformations

```bash
# Scale and translate
splat-transform bunny.ply -s 0.5 -t 0,0,10 bunny_scaled.ply

# Rotate by 90 degrees around Y axis
splat-transform input.ply -r 0,90,0 output.ply

# Chain multiple transformations
splat-transform input.ply -s 2 -t 1,0,0 -r 0,0,45 output.ply
```

### Filtering

```bash
# Remove entries containing NaN and Inf
splat-transform input.ply --filter-nan output.ply

# Filter by opacity values (keep only splats with opacity > 0.5)
splat-transform input.ply -V opacity,gt,0.5 output.ply

# Strip spherical harmonic bands higher than 2
splat-transform input.ply --filter-harmonics 2 output.ply
```

### Advanced Usage

```bash
# Combine multiple files with different transforms
splat-transform -w cloudA.ply -r 0,90,0 cloudB.ply -s 2 merged.compressed.ply

# Apply final transformations to combined result
splat-transform input1.ply input2.ply output.ply -t 0,0,10 -s 0.5
```

### Generators (Beta)

Generator scripts can be used to synthesize gaussian splat data. See [gen-grid.mjs](generators/gen-grid.mjs) for an example.

```bash
splat-transform gen-grid.mjs -p width=10,height=10,scale=10,color=0.1 scenes/grid.ply -w
```

### Device Selection for SOG Compression

When compressing to SOG format, you can control which device (GPU or CPU) performs the compression:

```bash
# List available GPU adapters
splat-transform --list-gpus

# Let WebGPU automatically choose the best GPU (default behavior)
splat-transform input.ply output.sog

# Explicitly select a GPU adapter by index
splat-transform -g 0 input.ply output.sog  # Use first listed adapter
splat-transform -g 1 input.ply output.sog  # Use second listed adapter

# Use CPU for compression instead (much slower but always available)
splat-transform -g cpu input.ply output.sog
```

> [!NOTE]
> When `-g` is not specified, WebGPU automatically selects the best available GPU. Use `-L` to list available adapters with their indices and names. The order and availability of adapters depends on your system and GPU drivers. Use `-g <index>` to select a specific adapter, or `-g cpu` to force CPU computation.

> [!WARNING]
> CPU compression can be significantly slower than GPU compression (often 5-10x slower). Use CPU mode only if GPU drivers are unavailable or problematic.

## Orbit Render - Render Orbit Sequences

A new tool for rendering orbit sequences from PLY files is available in [tools/orbit-render](tools/orbit-render/).

**Quick Start:**

```bash
cd tools/orbit-render
npm install

# Render 36 frames (360 degrees) with default settings
node index.mjs input.ply

# Render with custom settings
node index.mjs input.ply -f 72 -r 10 -o ./my_frames

# Use presets for common scenarios
node use-preset.mjs input.ply quick_preview ./preview
```

**Features:**
- ğŸ¬ Automatic orbit camera animation
- ğŸ“ Customizable camera orbit radius, height, and FOV
- ğŸ–¼ï¸ Support for custom output resolutions
- ğŸ¯ Configurable camera target point and start angle
- ğŸ§¹ Automatic cleanup of temporary files
- ğŸš€ High-quality WebGL rendering via Puppeteer

For detailed documentation, see [tools/orbit-render/README.md](tools/orbit-render/README.md).

## Getting Help

```bash
# Show version
splat-transform --version

# Show help
splat-transform --help
```
